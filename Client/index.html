<html>
<head>
	<title>Attack On Purdue Login</title>
	<!--<link rel="stylesheet" type="text/css" href="styles.css">-->
</head>
<body id="body">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<div id="init_div" style="display: block">
		<h1 style="padding: 0 0 35px;text-align: center;font: Arvo">ATTACK ON PURDUE</h1>

		<div style="padding: 0 0 30px">
			<p class="inputP" style="display: inline;">Username:  </p>
			<input type="text" id="usernameInput" type="username" placeholder="Enter Username">
		</div>
		<div style="padding: 0 0 15px">
			<p class="inputP" style="display: inline;margin: 1.5px">Password:  </p>
			<input type="password" id="passwordInput" placeholder="Enter Password">
		</div>
		<div>
			<p class="loginResponse" style="color: red; text-align: left;"></p>
		</div>
		<div class="buttonHolder" style="text-align: center;">
			<button class="loginButton" onclick="login()" style="margin: 6%">Login</button>
			<button class="signupButton" onclick="showSignupPage()">Sign Up</button>
		</div>
	</div>

	<dir id="signup_div" style="display: none">
		<h1>Create Account</h1>
		<div style="padding: 0 0 30px">
			<p class="inputP" style="display: inline;">Username:  </p>
			<input type="text" id="signupUsername" type="username" placeholder="Enter Username">
		</div>
		<div style="padding: 0 0 15px">
			<p class="inputP" style="display: inline;margin: 1.5px">Password:  </p>
			<input type="password" id="signupPassword" placeholder="Enter Password">
		</div>
		<div>
			<p class="signupResponse" style="color: red; text-align: left;"></p>
		</div>
		<div class="buttonHolder" style="text-align: center;">
			<button class="signupButton" onclick="signup()">Sign Up</button>
		</div>
	</dir>

	<div id="lobby_div" style="display: none; text-align: center;">
		<h1 class="welcomeHeader">WELCOME!</h1>
		<p>You are officially logged in and ready to play!</p>
		<button class="signOutButton" onclick="signOut()" style="">sign out</button>
		<p class="serverPickText">Pick a server below or create one</p>
		<div class="serverHolder">
			<div class="server" id="Server 0" style="display: none">
				<p class="serverName">Server 1</p>
				<p class="playerCount" id="pc_0">1 Players</p>
				<button class="playButton" id="b0" onclick="joinGame('b0')">Join</button> 
			</div>
			<div class="divider"> </div>
			<div class="server" id="Server 1" style="display: none">
				<p class="serverName">Server 2</p>
				<p class="playerCount" id="pc_1">1 Players</p>
				<button class="playButton" id="b1" onclick="joinGame('b1')">Join</button> 
			</div>
			<div class="divider"> </div>
			<div class="server" id="Server 2" style="display: none">
				<p class="serverName">Server 3</p>
				<p class="playerCount" id="pc_2">1 Players</p>
				<button class="playButton" id="b2" onclick="joinGame('b2')">Join</button> 
			</div>
			<div class="divider"> </div>
			<div class="server" id="Server 3" style="display: none">
				<p class="serverName">Server 4</p>
				<p class="playerCount" id="pc_3">1 Players</p>
				<button class="playButton" id="b3" onclick="joinGame('b3')">Join</button> 
			</div>
			<div class="divider"> </div>
			<div class="server" id="Server 4" style="display: none">
				<p class="serverName">Server 5</p>
				<p class="playerCount" id="pc_4">1 Players</p>
				<button class="playButton" id="b4" onclick="joinGame('b4')">Join</button> 
			</div>
		</div>
		<button class="createGameButton" onclick="createGame()">Create Game</button>
	</div>
	
	<div id="game_lobby_div" style="display: none; text-align: center;">
		<script type="text/javascript">
			
		</script>
		<h1 class="welcomeHeader" style="position: absolute; width: 40%; left: 30%; top: 10%;">Waiting on the host to start the game</h1>
		<button class="signOutButton" onclick="signOut()" style="">sign out</button>
		<p class="serverPickText">Pick a server below or create one</p>
		<div class="playerListHolder">
			<div class="playerPart" id="Player 0" style="display: none">
				<p class="playerName" id="pname 0">Player Name</p>
				<button class="playerType" id="status 0" onclick="">Hos</button> 
			</div>
			<div class="divider"> </div>
			<div class="playerPart" id="Player 1" style="display: none">
				<p class="playerName" id="pname 1">Player Name</p>
				<button class="playerType" id="status 1" onclick="">Hos</button> 
			</div>
			<div class="divider"> </div>
			<div class="playerPart" id="Player 2" style="display: none">
				<p class="playerName" id="pname 2">Player Name</p>
				<button class="playerType" id="status 2" onclick="">Hos</button> 
			</div>
			<div class="divider"> </div>
			<div class="playerPart" id="Player 3" style="display: none">
				<p class="playerName" id="pname 3">Player Name</p>
				<button class="playerType" id="status 3" onclick="">Hos</button> 
			</div>
		</div>
		<button class="startGameButton" id="start_button" style="display: block" onclick="startGame()">Start Game</button>
	</div>

	<!-- Canvas stuff -->
	<div id="canvas" style="
		display: none;
		z-index: 2;
		position: relative;
	"> 
		<canvas id="ctx" height="5000" width="5000" style="
			border:1px solid #000000;
			height: 100%;
			width: 100%;
		"></canvas>
	</div>

	<!-- Google maps stuff -->
	<div id="map" style="
		display: none;
		height: 100%;
		width: 100%;
		z-index: 1;
		position: relative;
		top: -100%;
	"></div>
    <script>
      function initMap() {
      	var styledMapType = new google.maps.StyledMapType([
      		{
    			featureType: "poi",
    			elementType: "labels",
    			stylers: [
      				{ visibility: "off" }
    			]
  			},{
  				featureType: "road",
    			elementType: "labels",
    			stylers: [
      				{ visibility: "off" }
    			]
  			},{
  				featureType: 'water',
  				elementType: "labels",
    			stylers: [
      				{ visibility: "off" }
    			]
  			}
      	],
      	{name: "Styled Map"});

        var uluru = {lat: 40.426490, lng: -86.918943};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 16,
          center: uluru,
          disableDefaultUI: true,
        });

        var m_earhart = new google.maps.Marker({
        	position: {lat: 40.425820, lng: -86.924948},
        	map: map
        });

        var m_tark = new google.maps.Marker({
        	position: {lat: 40.430616, lng: -86.920707},
        	map: map
        });

        var m_armstrong = new google.maps.Marker({
        	position: {lat: 40.430981, lng: -86.914859},
        	map: map
        });

        var m_memorial = new google.maps.Marker({
        	position: {lat: 40.424990, lng: -86.914324},
        	map: map
        });

        map.mapTypes.set('styled_map', styledMapType);
        map.setMapTypeId('styled_map');
      }
    </script>
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD08t5k4spnUy46bHoyxvmNTIcetBLQAdE&callback=initMap">
  	</script>

  	<!-- Socket stuff -->
	<script src="/socket.io/socket.io.js"></script>
	<script> 
		var socket = io();

		//BEGGINING STUFF
		function showSignupPage()
		{
			document.getElementsByClassName("signupResponse")[0].innerHTML = "";
			document.getElementById("lobby_div").style.display = "none";
			document.getElementById("init_div").style.display = "none";
			document.getElementById("signup_div").style.display = "block";
		}
		
		function signup()
		{
			var userN = document.getElementById("signupUsername").value;
			var passW = document.getElementById("signupPassword").value;
			console.log("Username: " + userN + ", Password: " + passW);
			socket.emit('signup', {username: userN, password: passW});
		}
		
		socket.on('signupResponse', function(data)
		{
			if (data.success == true)
			{
				document.getElementById("lobby_div").style.display = "none";
				document.getElementById("init_div").style.display = "block";
				document.getElementById("signup_div").style.display = "none";
				document.getElementsByClassName("welcomeHeader")[0].innerHTML = "Welcome " + document.getElementById("signupUsername").value;
			}
			else
			{
				document.getElementsByClassName("signupResponse")[0].innerHTML = data.state;
				console.log("Failed to login");
			}
		});
		
		function login() 
		{
			var userN = document.getElementById("usernameInput").value;
			var passW = document.getElementById("passwordInput").value;
			console.log("Username: " + userN + ", Password: " + passW);
			socket.emit('login', {username: userN, password: passW});
		}
		
		socket.on('loginResponse', function(data) 
		{
			if (data.success == true)
			{
				document.getElementById("lobby_div").style.display = "block";
				document.getElementById("init_div").style.display = "none";
				document.getElementById("signup_div").style.display = "none";
			}
			else
			{
				document.getElementsByClassName("loginResponse")[0].innerHTML = data.state;
				console.log("Failed to login");
			}
		});

		function signOut() 
		{
			socket.emit('logout', {});
			console.log("Attempting to logout");
		}
		
		socket.on('logoutResponse', function(data)
		{
			if (data.success == true)
			{
				document.getElementById("signupUsername").value = "";
				document.getElementById("signupPassword").value = "";
				document.getElementById("usernameInput").value = "";
				document.getElementById("passwordInput").value = "";
				document.getElementsByClassName("loginResponse")[0].innerHTML = "";
				document.getElementById("game_lobby_div").style.display = "none";
				document.getElementById("lobby_div").style.display = "none";
				document.getElementById("init_div").style.display = "block";
				document.getElementById("signup_div").style.display = "none";
			}
			else { console.log("Failed to logout"); }
		});
		
		/* ############ LOBBY STUFF ################# */

		//for updating the games list
		socket.on('getCreatedGamesResponse', function(data) {
			var games = data.games;
			for (var i = 0; i < games.length; i++)
			{
				//binds game id to button for join game
				var button = "b" + i;
				document.getElementById(button).setAttribute("gameId", games[i].id);
				//console.log(document.getElementById(button).getAttribute("gameId"));
				var name = "Server " + i;
				document.getElementById(name).style.display = "block";
				var playerCountText = "pc_" + i;
				document.getElementById(playerCountText).innerHTML = games[i].numPlayers + " Players";
				//console.log(games[i].id);
			}
		});

		//for updating the player list
		socket.on('getPlayersInGameResponse', function(data) {
			var players = data.players;
			for (var i = 0;i < players.length; i++) {
				//start game button 
				//THIS NEEDS COOKIES ENABLED TO TOGGLE START GAME BUTTON

				//player name
				var pname = "pname " + i;
				document.getElementById(pname).innerHTML = players[i].name;

				//host or player
				var pstatus = "status " + i;
				document.getElementById(pstatus).innerHTML = players[i].hosting;

				//update what player number
				var pid = "Player " + i;
				document.getElementById(pid).style.display = "block";
			}
		});

		function joinGame(buttonId) {
			var gameid = document.getElementById(buttonId).getAttribute("gameId");
			socket.emit('joinGame', {gameId: gameid});
		}
		
		socket.on('joinGameResponse', function(data) {
			if (data.success == true) {
				document.getElementById("game_lobby_div").style.display = "block";
				document.getElementById("lobby_div").style.display = "none";
			} else {
				console.log("Failed to join game");
			}
		});

		function createGame()
		{
			socket.emit('createGame', {});
		}
		
		socket.on('createGameResponse', function(data) {
			if (data.success == true) {
				document.getElementById("lobby_div").style.display = "none";
				//document.getElementById("game_lobby_div").setAttribute("gameId", data.gameId);
				document.getElementById("game_lobby_div").style.display = "block";
			} else {
				document.getElementsByClassName("createGame")[0].innerHTML = data.state;
				console.log("Failed to login");
			}
		});

		function startGame() {
			socket.emit('startGame', {});
		}
		/*
		socket.on('startGameResponse', function(data) {
			if (data.success == true) {
				document.getElementById("game_lobby_div").style.display = "none";
				document.getElementById("ctx").style.display = "block";
			} else {
				console.log("Failed to start game");
			}
		});*/

		//GAME STUFF

		var ctx = document.getElementById("ctx").
		getContext("2d");
		ctx.font = '30px Arial';
		socket.on('positionUpdate', function(data){
			document.getElementById("game_lobby_div").style.display = "none";
			document.getElementById("body").style.backgroundImage = "none";
			document.getElementById("canvas").style.display = "block";
			document.getElementById("map").style.display = "block";

			//console.log("The new x position is " + data.x);
			//console.log("\nThe new y position is " + data.y);
			ctx.clearRect(0,0,500,500);
			/*
			for (var i = 0;i<data.length;i++) {
				ctx.fillText(data[i].number,data[i].x,data[i].y);
			}*/
		});
		/*
		//when key is pressed send signal to server
		document.onkeydown = function(event) {
			if (event.keyCode === 68) { 
				//d
				socket.emit('keyPress', {inputId:'right',state:true});
			} else if (event.keyCode === 83) {
				//s
				socket.emit('keyPress', {inputId:'down',state:true});
			} else if (event.keyCode === 65) {
				//a
				socket.emit('keyPress', {inputId:'left',state:true});
			} else if (event.keyCode === 87) {
				//w
				socket.emit('keyPress', {inputId:'up',state:true});
			}
		}

		//when key is released send signal to server
		document.onkeyup = function(event) {
			if (event.keyCode === 68) { 
				//d
				socket.emit('keyPress', {inputId:'right',state:false});
			} else if (event.keyCode === 83) {
				//s
				socket.emit('keyPress', {inputId:'down',state:false});
			} else if (event.keyCode === 65) {
				//a
				socket.emit('keyPress', {inputId:'left',state:false});
			} else if (event.keyCode === 87) {
				//w
				socket.emit('keyPress', {inputId:'up',state:false});
			}
		}*/
	</script>
</body>
</html>